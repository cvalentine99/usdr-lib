const __m512i mask0 = _mm512_set1_epi64(0xfff00000fff00000);
const __m512i mask1 = _mm512_set1_epi64(0x0000fff00000fff0);

const __m512i permmask = _mm512_set_epi32(11,10,9, 15,14, 8,7,6, 5,4,3, 13,12, 2,1,0);
const __m512i shfl = _mm512_set_epi8(
    0x0f, 0x0e, 0x0d, 0x80, 0x0c, 0x0b, 0x0a, 0x80,
    0x09, 0x08, 0x07, 0x80, 0x06, 0x05, 0x04, 0x80,
    0x0b, 0x0a, 0x09, 0x80, 0x08, 0x07, 0x06, 0x80,
    0x05, 0x04, 0x03, 0x80, 0x02, 0x01, 0x00, 0x80,
    0x0f, 0x0e, 0x0d, 0x80, 0x0c, 0x0b, 0x0a, 0x80,
    0x09, 0x08, 0x07, 0x80, 0x06, 0x05, 0x04, 0x80,
    0x0b, 0x0a, 0x09, 0x80, 0x08, 0x07, 0x06, 0x80,
    0x05, 0x04, 0x03, 0x80, 0x02, 0x01, 0x00, 0x80);

#define CONVERT_I12_I16_BLOCK(reg, result) \
{   \
    __m512i v0 = _mm512_permutexvar_epi32(permmask, reg); \
    __m512i r  = _mm512_shuffle_epi8(v0, shfl); \
    \
    __m512i r0 = _mm512_and_si512(r, mask0); \
    __m512i r1 = _mm512_and_si512(_mm512_srli_epi64(r, 4), mask1); \
            result = _mm512_or_si512(r0, r1); \
}
