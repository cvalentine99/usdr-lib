const __m512i maske = _mm512_set1_epi64(0x0000fff00000fff0);
const __m512i masko = _mm512_set1_epi64(0xfff00000fff00000);

const __m512i shfl0 = _mm512_set_epi8(
    0x80, 0x80, 0x80, 0x80, 0x0f, 0x0e, 0x0d, 0x0b,
    0x0a, 0x09, 0x07, 0x06, 0x05, 0x03, 0x02, 0x01,
    0x80, 0x80, 0x80, 0x80, 0x0f, 0x0e, 0x0d, 0x0b,
    0x0a, 0x09, 0x07, 0x06, 0x05, 0x03, 0x02, 0x01,
    0x80, 0x80, 0x80, 0x80, 0x0f, 0x0e, 0x0d, 0x0b,
    0x0a, 0x09, 0x07, 0x06, 0x05, 0x03, 0x02, 0x01,
    0x80, 0x80, 0x80, 0x80, 0x0f, 0x0e, 0x0d, 0x0b,
    0x0a, 0x09, 0x07, 0x06, 0x05, 0x03, 0x02, 0x01);

const __m512i permmask0 = _mm512_set_epi32(/*zeros*/15,11,7,3, /*data*/14,13,12, 10,9,8, 6,5,4, 2,1,0);

#define CONVERT_I16_I12_BLOCK(rin, pout64) \
{ \
    __m512i ro0 = _mm512_and_si512(rin, masko); \
    __m512i re0 = _mm512_slli_epi64(_mm512_and_si512(rin, maske), 4); \
    __m512i r0  = _mm512_or_si512(ro0, re0); \
\
    __m512i res  = _mm512_shuffle_epi8(r0, shfl0); \
    res  = _mm512_permutexvar_epi32(permmask0, res); \
\
    _mm512_mask_storeu_epi64((long long *)pout64, 0b00111111, res); \
    pout64 += 6; \
}
